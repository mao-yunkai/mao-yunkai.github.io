# 几何学
## 解析几何
- 空间直角坐标系 右手规则，x轴向左，y轴向右，z轴向上
- 向量的模、方向角、投影
- 向量加法可以用平行四边形法则，将第二个向量的终点与第一个向量的起点相连，新向量是从第一个向量的起点到第二个向量的终点的向量。
- 向量减法可以用三角形法则，新向量是从第二个向量的终点到第一个向量向量终点的向量
- 向量的数量积  
    $$ \vec a\cdot \vec b=\cos\theta|\vec a||\vec b| = \sum_{i=1}^na_ib_i=a_1b_1 + a_2b_2 + ... $$  
    向量数量积的值可以表示两个向量的方向的相似度，值越大，两个向量方向越接近，最大值表示两个向量方向相同，最小值表示两个向量方向相反
- 向量的向量积 向量积$\vec c=\vec a\times \vec b$的模是$|\vec a| |\vec b| \sin\theta$，方向是按右手法则的法向量方向。
    $$ \vec a\times \vec b=\left(\begin{matrix}{a_{y}b_{z}-a_{z}b_{y}}\\\end{matrix}\right)i+\left(\begin{matrix}{a_{z}b_{z}-a_{x}b_{z}}\\\end{matrix}\right)j+\left(\begin{matrix}{a_{x}b_{y}-a_{y}b_{x}}\\\end{matrix}\right)k$$
    $$ \vec a\times \vec b=\begin{vmatrix}i&j&k\\a_x&a_y&a_z\\b_x&b_y&b_z\end{vmatrix} $$
- 平面的一般方程 $Ax+By+Cz+D=0$
- 空间直线的一般方程
    $$ \begin{cases}A_1x+B_1y+C_1z+D_1=0,\\[2ex]A_2x+B_2y+C_2z+D_2=0.\end{cases} $$
- 两直线夹角
    $$ \cos\varphi=\frac{\mid m_{1}m_{2}+n_{1}n_{2}+p_{1}p_{2}\mid}{\sqrt{m_{1}^{2}+n_{1}^{2}+p_{1}^{2}}\sqrt{m_{2}^{2}+n_{2}^{2}+p_{2}^{2}}} $$
- 直线与平面的夹角
    $$ \sin\varphi=\frac{\mid Am+Bn+Cp\mid}{\sqrt{A^2+B^2+C^2}\sqrt{m^2+n^2+p^2}}. $$
- 坐标系点$(x,y)$绕原点旋转变换公式：
    $$\begin{cases}
    x' = x\cos\theta+y\sin\theta \\
    y' = y\cos\theta-x\sin\theta \\
    \end{cases} $$
- 坐标系点$(x,y)$绕点$(x_1, y_1)$旋转变换公式：
    $$\begin{cases}
    x' = (x-x_1)\cos\theta+(y-y_1)\sin\theta+x_1 \\
    y' = (y-y_1)\cos\theta-(x-x_1)\sin\theta+y_1
    \end{cases} $$
- 曲面研究的基本问题
  - 已知一曲面作为点的几何轨迹时，建立这曲面的基本问题；
  - 已知坐标之间的一个方程时，研究方程所表示的曲面的形状。
- 曲面方程
  - 球面 - $x^2+y^2+z^2=R^2$
  - 旋转曲面 - 在曲线C的方程$f(y,z)=0$中将$y$改成$\pm\sqrt{x^{2}+y^{2}}$，便得曲线C绕z轴旋转所称的旋转曲面的方程。
  - 柱面 - $x^2+y^2=R^2$
  - 九种二次曲面，不一一列举
- 空间曲线
  - 一般方程  
    设$F(x,y,z)=0$和$G(x,y,z)=0$是两个曲面的方程，则方程组
    $$\begin{cases}F\left(x,y,z\right)=0,\\G\left(x,y,z\right)=0.\end{cases}$$
    就是这两个曲面的交线$C$的方程。
  - 参数方程
    $$ \begin{cases}x=x(t),\\y=y(t),\\z=z(t).\end{cases} $$
## 刚体运动
### 旋转矩阵
三维线性空间中的一组基$(\mathbfit e_1, \mathbfit e_2, \mathbfit e_3)$，任意向量$\mathbfit a$在这组基下有一个坐标

$$
\mathbfit a = [\mathbfit e_1, \mathbfit e_2, \mathbfit e_3]
\left [ \begin{array}{} a_1 \\ a_2 \\ a_3 \end{array}\right]
=
a_1\mathbfit e_1+a_2\mathbfit e_2+a_3\mathbfit e_3
$$

$(a_1, a_2, a_3)^T$称为$\mathbfit a$在此基下的坐标。
坐标系分为左手坐标系和右手坐标系，右手坐标系定义为拇指指向x轴正方向，食指指向y轴正方向，中指指向z轴正方向，左手坐标系定义相同。坐标系是一组单位正交基。
不同坐标系下表示的向量是相同的：

$$\mathbfit a = \begin{bmatrix} \mathbfit e_1&\mathbfit e_2&\mathbfit e_3\end{bmatrix}\begin{bmatrix}a_1\\a_2\\a_3\end{bmatrix}=\begin{bmatrix} \mathbfit e'_1&\mathbfit e'_2&\mathbfit e'_3\end{bmatrix}\begin{bmatrix}a'_1\\a'_2\\a'_3\end{bmatrix}$$

$$\begin{bmatrix}a_1\\a_2\\a_3\end{bmatrix}=
\begin{bmatrix}
e_1^T e_1 & e_1^T e_2 & e_1^T e_3 \\
e_2^T e_1 & e_2^T e_2 & e_2^T e_3 \\
e_3^T e_1 & e_3^T e_2 & e_3^T e_3
\end{bmatrix}
\begin{bmatrix}a'_1\\a'_2\\a'_3\end{bmatrix}$$

中间的矩阵定义为旋转矩阵$\mathbfit R$，该式表示旋转矩阵将向量$\mathbfit a'$转成$\mathbfit a$。

设向量$\mathbfit a$在坐标系1和坐标系2中的坐标分别为$\mathbfit a_1$，$\mathbfit a_2$。他们之间的关系为
$$\begin{align}
\mathbfit a_1 &= \mathbfit R_{12}\mathbfit a_2+\mathbfit t_{12} \\
\mathbfit a_2 &= \mathbfit R_{21}\mathbfit a_1+\mathbfit t_{21}
\end{align}
$$
这里$\mathbfit R_{12}$是指“把坐标系2的向量变换到坐标系1中”。$\mathbfit t_{12}$是平移向量，**实际对应的是从坐标系1原点指向坐标系2原点的向量，在坐标系1下取得坐标**。
$n$维旋转矩阵的集合是特殊正交群，定义为：
$$SO(n)=\{\mathbfit R\in \mathbb R^{n\times n}| \mathbfit R\mathbfit R^T=\mathbfit I, \det(\mathbfit R)=1 \}.$$
为了使多次变换具有线性关系，我们使用齐次坐标，即在每个三维向量的末尾添加1，将其变为四维向量。我们定义变换矩阵为：
$$
SE(3) = \left\{
    \boldsymbol{T} = 
    \begin{bmatrix}
        \boldsymbol{R} & \boldsymbol{t} \\
        \boldsymbol{0}^{\mathrm{T}} & 1
    \end{bmatrix} 
    \in \mathbb{R}^{4 \times 4} 
    \;\Bigg|\; 
    \boldsymbol{R} \in SO(3), \, \boldsymbol{t} \in \mathbb{R}^3 
\right\}
$$
### 旋转向量
旋转矩阵用9个量表示3个自由度的旋转，变换矩阵用16个量表示6个自由度的变换。使用一个旋转轴和一个旋转角来表示一个旋转，旋转向量定位为方向与旋转轴一致，长度等于旋转角的向量。假设旋转轴为一个单位长度的向量$\mathbfit n$，角度为$\theta$，那么向量$\theta \mathbfit n$也可以描述这个旋转。
使用罗德里格斯公式将旋转向量转为旋转矩阵：
$$
\mathbfit R = \cos\theta \mathbfit I + (1 - \cos\theta) \mathbfit{n} \mathbfit{n}^{T} + \sin\theta \, \mathbfit{n}^\wedge
$$
旋转矩阵转旋转向量：

$$
\begin{align}
\theta &= \arccos {\frac{tr(\mathbfit R)-1}{2}},\\
\mathbfit R\mathbfit n &= \mathbfit n.
\end{align}
$$

### 欧拉角
旋转可以看作是绕三个轴分别旋转一定角度组合而成。通常约定：
1. 绕物体的Z轴旋转，得到偏航角yaw。
2. 绕旋转之后的Y轴旋转，得到俯仰角pitch。
3. 绕旋转之后的X轴旋转，得到滚转角roll。
此时，可以使用$[r,p,y]^T$这样一个三维的向量描述任意旋转。
### 四元数
[Understanding Quaternions | 3D Game Engine Programming](https://www.3dgep.com/understanding-quaternions/)
四元数定义为：
$$\begin{align}
\mathbfit q=s+x\mathrm{i}+y\mathrm{j}+z\mathrm{k}\\
\begin{cases}
\mathrm {i^2=j^2=k^2=-1}\\
\mathrm {ij=k,ji=-k}\\
\mathrm {jk=i, kj=-i}\\
\mathrm {ki=j,ik=-j}
\end{cases}
\end{align}$$
其中$\mathrm{i,j,k}$为四元数的三个虚部。
把$\mathrm{i,j,k}$看成三个坐标轴，用一个标量和一个向量来表达四元数：
$$\mathbfit q=[s,\mathbfit v]^T, s=w\in \mathbb R, \mathbfit v=[x,y,z]^T\in \mathbb R^3.$$

| 运算  | 公式                                                                                                                                           |
| --- | -------------------------------------------------------------------------------------------------------------------------------------------- |
| 加减法 | $\mathbfit q_a \pm \mathbfit q_b = [s_a \pm s_b,\mathbfit v_a \pm \mathbfit v_b]^T$                                                          |
| 乘法  | $\mathbfit q_a \mathbfit q_b=[s_as_b-\mathbfit v_a^T \mathbfit v_b, s_a\mathbfit v_b +s_b\mathbfit v_a+\mathbfit v_a\times\mathbfit v_b ]^T$ |
| 模长  | $\parallel \mathbfit q_a \parallel=\sqrt {s_a^2+x_a^2+y_a^2+z_a^2}$                                                                          |
| 共轭  | $\mathbfit q^*_a=[s_a, -\mathbfit v_a]^T$                                                                                                    |
| 逆   | $\mathbfit q_a^{-1}=\mathbfit q^*/{\parallel \mathbfit q \parallel ^2}$                                                                      |
| 数乘  | $k\mathbfit q=[ks, k\mathbfit v]^T$                                                                                                          |

单位四元数$\mathbfit q=[s,\lambda\mathbfit {\hat v}]$可以表示一个旋转。三维空间中的一个点$\mathbfit p$经过绕单位向量$\mathbfit {\hat v}$旋转角度$\theta$得到$\mathbfit p'$，则用四元数表示为

$$
\begin{align}
\mathbfit q&=[\cos\frac{1}{2}\theta,\sin\frac{1}{2}\theta\mathbfit {\hat v}]\\
\mathbfit p'&=\mathbfit q\mathbfit p\mathbfit q^{-1}
\end{align}
$$
 
>**为什么用单位四元数？**
>因为旋转后向量模长不变，应当乘以单位四元数。
>**为什么要乘以四元数的逆？**
>$\mathbfit p'=\mathbfit q\mathbfit p=[-\lambda\mathbfit {\hat v}\mathbfit p,s\mathbfit p+\lambda\mathbfit {\hat v}\times\mathbfit p]$，经过旋转后三维空间中的点被带到四维空间了，实部不再为0，需要乘以四元数的逆才能将其变回纯四元数，重新映射到三维空间中。$\mathbfit p'=\mathbfit {qpq^{-1}}=[\lambda^2(\mathbfit{\hat v \times p})\cdot\mathbfit {\hat v},\cdots]$，因为叉积的向量与原向量垂直，两者点积必为0，因此实部必为0，得到的结果是纯四元数。
>**为什么角度要除以2？**
>当旋转轴与向量垂直的时候，旋转后的向量永远与原向量处于同一个空间，而一般情况下，旋转轴与原向量不垂直，需要旋转两次才能回到三维空间，则角度也需要相应的变化。